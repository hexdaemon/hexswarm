#!/usr/bin/env bash
# hs â€” tiny wrapper around hexswarm smart delegation
# Usage:
#   hs code "do the thing"
#   hs research "find stuff"
#   hs analysis "analyze stuff"
#   hs <agent> <type> "task"   (e.g. hs codex code "..." )

set -euo pipefail

HEXSWARM_DIR="${HEXSWARM_DIR:-/home/sat/bin/hexswarm}"

if [[ $# -lt 2 ]]; then
  echo "Usage: hs <type|agent> <type|description> [description...]" >&2
  echo "Examples:" >&2
  echo "  hs code \"refactor the storage module\"" >&2
  echo "  hs auto research \"find papers on LN routing\"" >&2
  echo "  hs codex code \"implement feature X\"" >&2
  exit 1
fi

first="$1"; shift
second="$1"; shift || true

# If first arg is a known type, assume auto agent
case "$first" in
  code|research|analysis|general)
    agent="auto"
    type="$first"
    # Description is second + rest
    if [[ -n "${second:-}" ]]; then
      desc="$second${*:+ }$*"
    else
      echo "Error: missing description" >&2
      exit 1
    fi
    ;;
  auto|claude-code|codex|gemini|hex)
    agent="$first"
    type="$second"
    desc="$*"
    if [[ -z "$desc" ]]; then
      echo "Error: missing description" >&2
      exit 1
    fi
    ;;
  *)
    echo "Error: unknown agent or type: $first" >&2
    echo "Agents: auto, claude-code (preferred), codex, gemini, hex" >&2
    echo "Types: code, research, analysis, general" >&2
    exit 1
    ;;
esac

"$HEXSWARM_DIR/bin/smart-delegate.sh" "$agent" "$type" "$desc"
